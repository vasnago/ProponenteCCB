<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a="http://richfaces.org/a4j" xmlns:p="http://primefaces.org/ui"
	xmlns:t="http://myfaces.apache.org/tomahawk"
	template="/plantillas/plantilla.xhtml">
	<ui:param name="action" value="usuarioAction.registrarUsuario(null)" />
	<ui:param name="titulo"
		value="mensaje.label_registrar,mensajeSeguridad.usuario_label" />
	<ui:define name="body">
		<h:form id="usuarioForm" styleClass="edit">
			<t:saveState value="#{usuarioAction}" />
			<t:saveState value="#{encodeFilter}" />

			<rich:panel
				header="#{mensaje.label_registrar} #{mensajeSeguridad.usuario_label}"
				styleClass="anchoUno">
				<t:fieldset styleClass="BorderW2P anchoDos">
					<legend class="etiquetaTitulo">#{mensaje.label_datos_basicos}</legend>
					<h:panelGrid columns="4"
						cellpadding="#{propNomina['locate.fields.cellpadding']}"
						cellspacing="#{propNomina['locate.fields.cellspacing']}">

						<h:outputText value="#{mensajeSeguridad.usuario_label_nombre}"
							styleClass="etiquetaTitulo" />
						<h:outputText value="*" styleClass="required" />
						<h:inputText maxlength="50" id="txtNombreUsuario"
							styleClass="colTextoMediano"
							value="#{usuarioAction.usuario.nombreUsuario}" required="true"
							rendered="#{!usuarioAction.editar}"
							requiredMessage="#{mensaje.message_campo_requerido}"
							validator="#{usuarioAction.validarNombreUsuario}">
							<f:validateLength maximum="50" />
						</h:inputText>
						<h:outputText value="#{usuarioAction.usuario.nombreUsuario}"
							styleClass="etiquetaValor etiquetaTitulo"
							rendered="#{usuarioAction.editar}" />
						<rich:message for="txtNombreUsuario" />

						<h:outputText styleClass="etiquetaTitulo"
							value="#{mensaje.label_nombre}" />
						<h:outputText value="*" styleClass="required" />
						<h:inputText maxlength="100" id="txtNombre"
							styleClass="colTextoMediano"
							value="#{usuarioAction.usuario.nombre}" required="true"
							requiredMessage="#{mensaje.message_campo_requerido}"
							validator="#{encodeFilter.validarScripting}">
							<f:validateLength maximum="100" />
						</h:inputText>
						<rich:message for="txtNombre" />

						<h:outputText styleClass="etiquetaTitulo"
							value="#{mensaje.label_apellido}" />
						<h:outputText value="*" styleClass="required" />
						<h:inputText maxlength="100" id="txtApellido"
							styleClass="colTextoMediano"
							value="#{usuarioAction.usuario.apellido}" required="true"
							requiredMessage="#{mensaje.message_campo_requerido}"
							validator="#{encodeFilter.validarScripting}">
							<f:validateLength maximum="100" />
						</h:inputText>
						<rich:message for="txtApellido" />

						<h:outputText value="#{mensaje.label_email}"
							styleClass="etiquetaTitulo" />
						<h:outputText value="" />
						<h:inputText value="#{usuarioAction.usuario.correoElectronico}"
							id="txtEmail" styleClass="colTextoLargo" maxlength="150"
							validator="#{encodeFilter.validarScripting}">
							<f:validateLength maximum="150" />
							<f:attribute name="nameRegEx" value="locate.regex.email" />
						</h:inputText>
						<rich:message for="txtEmail" />

						<h:outputText styleClass="etiquetaTitulo"
							value="#{mensaje.label_contrasena}"
							rendered="#{!usuarioAction.editar}" />
						<h:outputText value="*" styleClass="required"
							rendered="#{!usuarioAction.editar}" />
						<h:inputSecret id="txtPassword" styleClass="colTextoCorto"
							maxlength="12" value="#{usuarioAction.usuario.password}"
							required="true" validator="#{usuarioAction.validarContrasena}"
							requiredMessage="#{mensaje.message_campo_requerido}"
							rendered="#{!usuarioAction.editar}">
							<f:validateLength minimum="6" maximum="12" />
							<f:attribute name="idAsociado" value="txtPasswordConfirmar" />
						</h:inputSecret>
						<rich:message for="txtPassword"
							rendered="#{!usuarioAction.editar}" />

						<h:outputText styleClass="etiquetaTitulo"
							value="#{mensajeSeguridad.usuario_label_confirmar_contrasena}"
							rendered="#{!usuarioAction.editar}" />
						<h:outputText value="*" styleClass="required"
							rendered="#{!usuarioAction.editar}" />
						<h:inputSecret id="txtPasswordConfirmar"
							styleClass="colTextoCorto" maxlength="12"
							value="#{usuarioAction.password2}" required="true"
							validator="#{encodeFilter.validarScripting}"
							requiredMessage="#{mensaje.message_campo_requerido}"
							rendered="#{!usuarioAction.editar}">
							<f:validateLength minimum="6" maximum="12" />
						</h:inputSecret>
						<rich:message for="txtPasswordConfirmar"
							rendered="#{!usuarioAction.editar}" />

						<h:outputText value="#{mensaje.label_contrasena}"
							rendered="#{usuarioAction.editar}" styleClass="etiquetaTitulo" />
						<h:outputText value="" rendered="#{usuarioAction.editar}" />
						<a:outputPanel id="outChangePassword">
							<a:commandButton render="modalContrasena:popupContrasena"
								styleClass="estiloBoton fondoRenovar W90P"
								oncomplete="#{rich:component('popupContrasena')}.show();"
								value="#{mensaje.button_renovar}"
								rendered="#{usuarioAction.editar and !usuarioAction.renovarPassword}">
							</a:commandButton>
							<a:commandButton value="#{mensaje.button_cancelar_renovar}"
								styleClass="estiloBoton fondoCancelRenovacion W170P"
								actionListener="#{usuarioAction.setRenovarPassword('false')}"
								render=":usuarioForm:outChangePassword"
								rendered="#{usuarioAction.editar and usuarioAction.renovarPassword}">
							</a:commandButton>
						</a:outputPanel>
						<rich:message for="outChangePassword"
							rendered="#{usuarioAction.editar}" />
					</h:panelGrid>
				</t:fieldset>
				<br />
				<t:fieldset styleClass="BorderW2P anchoDos">
					<legend class="etiquetaTitulo">#{mensajeSeguridad.usuario_label_rol}</legend>
					<a:region>
						<a:outputPanel id="outputRoles">
							<rich:message for="tRoles" />
							<br />
							<rich:extendedDataTable value="#{usuarioAction.roles}"
								var="objRol" id="tRoles" styleClass="H190P anchoCinco">
								<f:facet name="header">
									<h:outputText
										value="#{mensaje.label_listado_de} #{mensajeSeguridad.rol_label_s}" />
								</f:facet>
								<rich:column width="30px" styleClass="center">
									<f:facet name="header" />
									<a:commandLink render=":popupForm:popUpAsignarRol, mensajes"
										actionListener="#{usuarioAction.controladorListaRoles('newRolUsuario', null)}"
										oncomplete="#{rich:component('popUpAsignarRol')}.show(); setFocus('popupForm:calFechaInicio_input');"
										execute="@region">
										<h:graphicImage value="/img/add_16.png" />
										<f:setPropertyActionListener value="#{objRol}"
											target="#{usuarioAction.rol}" />
										<rich:tooltip layout="block">
											<h:outputText value="#{mensaje.label_asignar}" />
										</rich:tooltip>
									</a:commandLink>
								</rich:column>
								<rich:column width="250px">
									<f:facet name="header">#{mensaje.label_nombre}</f:facet>
									<h:outputText value="#{objRol.nombre}" />
								</rich:column>
								<rich:column width="350px">
									<f:facet name="header">#{mensaje.label_descripcion}</f:facet>
									<h:outputText value="#{objRol.descripcion}" />
								</rich:column>
							</rich:extendedDataTable>
							<br />
							<rich:message for="selVigencia" />
							<h:selectOneRadio id="selVigencia"
								value="#{usuarioAction.vigenciaRolUsuario}"
								rendered="#{usuarioAction.editar}">
								<f:selectItem itemValue="nuevo"
									itemLabel="#{mensaje.label_nuevos}" />
								<f:selectItem itemValue="si"
									itemLabel="#{mensaje.label_vigentes}" />
								<f:selectItem itemValue="no"
									itemLabel="#{mensaje.label_no_vigentes}" />
								<a:ajax event="click"
									listener="#{usuarioAction.controladorRolUsuario()}"
									render="tablaRolesUsuario, mensajes">
								</a:ajax>
							</h:selectOneRadio>
							<a:outputPanel id="tablaRolesUsuario">
								<rich:extendedDataTable value="#{usuarioAction.rolesUsuario}"
									var="rolesUsuarioList" id="rolesUsuarioSelect"
									styleClass="H190P anchoCinco">
									<f:facet name="header">
										<h:outputText
											value="#{mensajeSeguridad.usuario_label_rol_asignados}" />
									</f:facet>
									<rich:column width="30px" styleClass="center">
										<f:facet name="header" />
										<a:commandLink render=":usuarioForm:outputRoles, mensajes"
											rendered="#{usuarioAction.vigenciaRolUsuario eq 'nuevo'}"
											actionListener="#{usuarioAction.controladorListaRoles('borrar', rolesUsuarioList)}"
											execute="@region">
											<h:graphicImage value="/img/delete_16.png" />
											<rich:tooltip layout="block">
												<h:outputText value="#{mensaje.label_quitar}" />
											</rich:tooltip>
										</a:commandLink>
										<a:commandLink render=":popupForm:popUpAsignarRol, mensajes"
											rendered="#{usuarioAction.vigenciaRolUsuario ne 'nuevo'}"
											actionListener="#{usuarioAction.controladorListaRoles('reNewRolUsuario', rolesUsuarioList)}"
											oncomplete="#{rich:component('popUpAsignarRol')}.show(); setFocus('popupForm:calFechaInicio_input');"
											execute="@region">
											<h:graphicImage value="/img/renovar_16.png" />
											<f:setPropertyActionListener value="#{rolesUsuarioList}"
												target="#{usuarioAction.rolUsuario}" />
											<rich:tooltip layout="block">
												<h:outputText value="#{mensaje.button_renovar}" />
											</rich:tooltip>
										</a:commandLink>
									</rich:column>
									<rich:column width="300px">
										<f:facet name="header">#{mensaje.label_nombre}</f:facet>
										<h:outputText
											value="#{rolesUsuarioList.rolUsuarioPK.rol.nombre}" />
									</rich:column>
									<rich:column width="150px" styleClass="top center">
										<f:facet name="header">#{mensaje.label_fecha_inicio}</f:facet>
										<h:outputText value="#{rolesUsuarioList.fechaInicioVigencia}">
											<f:convertDateTime pattern="MMM dd, yyyy"
												locale="#{idioma.locale}" />
										</h:outputText>
									</rich:column>
									<rich:column width="150px" styleClass="top center">
										<f:facet name="header">#{mensaje.label_fecha_fin}</f:facet>
										<h:outputText value="#{rolesUsuarioList.fechaFinVigencia}">
											<f:convertDateTime pattern="MMM dd, yyyy"
												locale="#{idioma.locale}" />
										</h:outputText>
									</rich:column>
								</rich:extendedDataTable>
							</a:outputPanel>
						</a:outputPanel>
					</a:region>
				</t:fieldset>
				<br />
				<div class="anchoDos center inBlock">
					<a:commandButton value="#{mensaje.button_guardar}"
						render="formGenerico,confirmacionPopUp"
						actionListener="#{usuarioAction.setUsuario(usuarioAction.usuario)}"
						oncomplete="if (#{facesContext.maximumSeverity==null}) {#{rich:component('confirmacionPopUp')}.show();}
						else { setFocus(#{rich:element('formGenerico:valFocus')}.value); }"
						rendered="#{(usuarioAction.editar and identity.autorizado('usuarioAction','U')) or identity.autorizado('usuarioAction','A') or identity.autorizado('usuarioAction','I')}" />
				</div>
			</rich:panel>
		</h:form>
		<h:form id="popupForm">
			<rich:popupPanel id="popUpAsignarRol" autosized="true"
				domElementAttachment="form">
				<f:facet name="header">#{mensaje.label_asignar}</f:facet>
				<br />
				<rich:messages id="mensajesPopup" styleClass="messageBlock" />
				<h:panelGrid columns="3" cellpadding="3" cellspacing="4">
					<h:outputText value="#{mensaje.label_fecha_inicio}"
						styleClass="etiquetaTitulo" />
					<h:outputText value="*" styleClass="required" />
					<p:calendar onchange="setFocus('popupForm:calFechaInicio_input');"
						onkeypress="return submitByEnter(event,'popupForm:btnBuscarC')"
						value="#{usuarioAction.selectFechaInicio}" id="calFechaInicio"
						showOn="button" required="true"
						label="#{mensaje.label_fecha_inicio}" />

					<h:outputText value="#{mensaje.label_fecha_fin}"
						styleClass="etiquetaTitulo" />
					<h:outputText value="" />
					<p:calendar onchange="setFocus('popupForm:calFechaFin_input');"
						onkeypress="return submitByEnter(event,'popupForm:btnBuscarC')"
						value="#{usuarioAction.selectFechaFin}" id="calFechaFin"
						showOn="button" validator="#{usuarioAction.validarFechas}" />
				</h:panelGrid>
				<br />
				<div class="W100Per center inBlock">
					<a:commandButton value="#{mensaje.button_aceptar}" id="btnBuscarC"
						rendered="#{!usuarioAction.renovarRol}"
						actionListener="#{usuarioAction.controladorListaRoles('addRolUsuario', null)}"
						oncomplete="if (#{facesContext.maximumSeverity.ordinal == 0} || #{facesContext.maximumSeverity==null}) {#{rich:component('popUpAsignarRol')}.hide();}"
						render=":usuarioForm:outputRoles, :usuarioForm:selVigencia, :usuarioForm:tablaRolesUsuario, mensajes">
					</a:commandButton>
					<a:commandButton value="#{mensaje.button_aceptar}"
						rendered="#{usuarioAction.renovarRol}"
						actionListener="#{usuarioAction.controladorListaRoles('changeRolUsuario', null)}"
						oncomplete="if (#{facesContext.maximumSeverity.ordinal == 0} || #{facesContext.maximumSeverity==null}) {#{rich:component('popUpAsignarRol')}.hide();}"
						render=":usuarioForm:outputRoles, :usuarioForm:selVigencia, :usuarioForm:tablaRolesUsuario, mensajes">
					</a:commandButton>
					<h:commandButton value="#{mensaje.button_cancelar}">
						<rich:componentControl target="popUpAsignarRol" operation="hide"
							event="click" />
					</h:commandButton>
				</div>
			</rich:popupPanel>
		</h:form>

		<h:form id="modalContrasena">
			<rich:popupPanel id="popupContrasena" autosized="true"
				header="#{mensaje.label_confirmacion}" domElementAttachment="form">
				<f:facet name="controls">
					<h:outputLink value="#"
						onclick="#{rich:component('popupContrasena')}.hide(); return false;">
						<img src="#{request.contextPath}/img/close_14.png"
							onmouseover="this.src='#{request.contextPath}/img/closeHover_14.png';"
							onmouseout="this.src='#{request.contextPath}/img/close_14.png';" />
					</h:outputLink>
				</f:facet>
				<ui:decorate template="/plantillas/mensajeConfirmar.xhtml">
					<ui:define name="mensaje">
						<h:outputText
							value="#{mensajeSeguridad.usuario_message_renovar_contrasena}"
							styleClass="etiquetaTitulo" />
					</ui:define>
					<ui:define name="botones">
						<a:commandButton value="#{mensaje.button_aceptar}"
							actionListener="#{usuarioAction.setRenovarPassword('true')}"
							oncomplete="#{rich:component('popupContrasena')}.hide()"
							render=":usuarioForm:outChangePassword">
						</a:commandButton>
						<a:commandButton value="#{mensaje.button_cancelar}"
							onclick="#{rich:component('popupContrasena')}.hide()" />
					</ui:define>
				</ui:decorate>
			</rich:popupPanel>

			<rich:popupPanel id="confirmacionPopUp" modal="true" autosized="true"
				resizeable="false" header="#{mensaje.label_confirmacion}">
				<f:facet name="controls">
					<h:outputLink value="#"
						onclick="#{rich:component('confirmacionPopUp')}.hide(); return false;">
						<img src="#{request.contextPath}/img/close_14.png"
							onmouseover="this.src='#{request.contextPath}/img/closeHover_14.png';"
							onmouseout="this.src='#{request.contextPath}/img/close_14.png';" />
					</h:outputLink>
				</f:facet>
				<ui:decorate template="/plantillas/mensajeConfirmar.xhtml">
					<ui:define name="mensaje">
						<h:outputText value="#{mensaje.message_registro_confirmacion}"
							styleClass="etiquetaTitulo" />
					</ui:define>
					<ui:define name="campos">
						<h:outputText value="#{mensajeSeguridad.usuario_label_nombre}: " />
						<h:outputText value="#{usuarioAction.usuario.nombreUsuario}" />
						<h:outputText value="#{mensaje.label_nombre}: " />
						<h:outputText
							value="#{usuarioAction.usuario.nombre} #{usuarioAction.usuario.apellido}" />
					</ui:define>
					<ui:define name="botones">
						<h:commandButton value="#{mensaje.button_aceptar}"
							action="#{usuarioAction.guardarUsuario}"
							onclick="#{rich:component('confirmacionPopUp')}.hide();#{rich:component('statPane')}.show();" />
						<a:commandButton value="#{mensaje.button_cancelar}"
							onclick="#{rich:component('confirmacionPopUp')}.hide()" />
					</ui:define>
				</ui:decorate>
			</rich:popupPanel>
		</h:form>
	</ui:define>
</ui:composition>